<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>حجز موعد جديد</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap');
        body { font-family: 'Tajawal', sans-serif; background-color: #f8f9fa; }
        .navbar-custom { background-color: #00bcd4; } 
        .expert-card-header {
            background-color: #e0f7fa; 
            border-right: 5px solid #00bcd4;
            border-radius: 8px;
        }
        .time-slot {
            cursor: pointer;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 10px;
            transition: all 0.2s;
            margin-bottom: 10px;
            text-align: center;
        }
        .time-slot:hover {
            border-color: #00bcd4;
            box-shadow: 0 0 5px rgba(0, 188, 212, 0.5);
        }
        .time-slot.selected {
            background-color: #00bcd4;
            color: white;
            border-color: #0097a7;
        }
        .time-slot.unavailable {
            background-color: #fce4ec;
            color: #d81b60;
            cursor: not-allowed;
            opacity: 0.6;
            border-color: #f8bbd0;
        }
        .btn-primary-custom {
            background-color: #00bcd4; 
            border-color: #00bcd4;
            color: white;
        }
        .btn-primary-custom:hover {
            background-color: #0097a7;
            border-color: #0097a7;
        }
        .date-select {
            cursor: pointer;
            transition: all 0.2s;
        }
        .date-select:hover {
            background-color: #f0f0f0;
        }
        .date-select.active {
            background-color: #00bcd4;
            color: white;
        }
        .date-select.active .badge {
            background-color: white !important;
            color: #00bcd4 !important;
        }
        
        /* تنسيقات شاشة الدفع */
        .payment-method {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .payment-method:hover {
            border-color: #00bcd4;
        }
        .payment-method.selected {
            border-color: #00bcd4;
            background-color: #e0f7fa;
        }
        .payment-icon {
            font-size: 24px;
            margin-left: 10px;
        }
    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-dark navbar-custom shadow-sm">
        <div class="container">
            <a class="navbar-brand fw-bold" href="client-browse-updated.html">منصة الخبراء</a>
            <div class="collapse navbar-collapse">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link" href="client-browse-updated.html">تصفح الخبراء</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="my-appointments.html">مواعيدي</a>
                    </li>
                </ul>
            </div>
            <a href="profile.html" class="btn btn-outline-light me-2"><i class="bi bi-person-fill"></i> الملف الشخصي</a>
        </div>
    </nav>

    <!-- شاشة حجز الموعد -->
    <div class="container py-5" id="bookingScreen">
        
        <a href="client-browse-updated.html" class="btn btn-sm btn-outline-secondary mb-3">
            <i class="bi bi-arrow-right me-1"></i> العودة للخلف
        </a>
        
        <h2 class="mb-4" style="color: #00bcd4;">حجز موعد مع خبير</h2>

        <div class="p-3 mb-4 expert-card-header d-flex align-items-center">
            <img src="https://via.placeholder.com/50/00bcd4/FFFFFF?text=S" class="rounded-circle me-3" style="width: 50px; height: 50px;">
            <div>
                <h5 class="mb-0">المحامي سعود القحطاني</h5>
                <p class="mb-0 text-muted">محامي شركات | السعر: 180 ر.س / 15 دقيقة</p>
            </div>
        </div>

        <div class="row">
            <div class="col-md-4 mb-4">
                <div class="card shadow-sm h-100">
                    <div class="card-header bg-light fw-bold">اختر التاريخ</div>
                    <div class="card-body">
                        <ul class="list-group list-group-flush" id="dateList">
                            <li class="list-group-item d-flex justify-content-between align-items-center date-select" data-date="2025-10-07">
                                الثلاثاء, 7 أكتوبر 
                                <span class="badge bg-success">10 متاح</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center date-select active" data-date="2025-10-08">
                                الأربعاء, 8 أكتوبر (اليوم)
                                <span class="badge bg-primary">5 متاح</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center date-select" data-date="2025-10-09">
                                الخميس, 9 أكتوبر 
                                <span class="badge bg-secondary">غير متاح</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center date-select" data-date="2025-10-10">
                                الجمعة, 10 أكتوبر 
                                <span class="badge bg-success">8 متاح</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center date-select" data-date="2025-10-11">
                                السبت, 11 أكتوبر 
                                <span class="badge bg-success">12 متاح</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="col-md-8 mb-4">
                <div class="card shadow-sm h-100">
                    <div class="card-header bg-light fw-bold" id="timeHeader">الأوقات المتاحة (الأربعاء 8 أكتوبر)</div>
                    <div class="card-body">
                        <div class="row" id="timeSlots">
                            <!-- سيتم ملؤها ديناميكياً -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card p-3 shadow-lg mt-4 border-0" id="bookingSummary">
            <h4 class="mb-3 text-center" style="color: #0097a7;">ملخص الحجز</h4>
            <div class="row align-items-center">
                <div class="col-md-6">
                    <p class="fw-bold mb-1">الخبير: المحامي سعود القحطاني</p>
                    <p class="mb-1">التاريخ: <span class="fw-bold text-success" id="summaryDate">الأربعاء, 8 أكتوبر 2025</span></p>
                    <p class="mb-0">الوقت: <span class="fw-bold text-primary" id="summaryTime">01:30 مساءً</span></p>
                </div>
                <div class="col-md-6 text-end">
                    <h3 class="mb-2">المبلغ الإجمالي: <span id="totalAmount">180</span> ر.س</h3>
                    <button class="btn btn-lg btn-primary-custom w-100" id="confirmBookingBtn">
                        <i class="bi bi-wallet-fill me-2"></i> تأكيد الحجز والانتقال للدفع
                    </button>
                </div>
            </div>
        </div>

    </div>

    <!-- شاشة الدفع -->
    <div class="container py-5" id="paymentScreen" style="display: none;">
        
        <a href="javascript:void(0)" class="btn btn-sm btn-outline-secondary mb-3" id="backToBookingBtn">
            <i class="bi bi-arrow-right me-1"></i> العودة لتعديل الحجز
        </a>
        
        <h2 class="mb-4" style="color: #00bcd4;">إتمام عملية الدفع</h2>

        <div class="row">
            <div class="col-md-8">
                <div class="card shadow-sm mb-4">
                    <div class="card-header bg-light fw-bold">طريقة الدفع</div>
                    <div class="card-body">
                        <div class="payment-method selected" data-method="credit">
                            <div class="d-flex align-items-center">
                                <i class="bi bi-credit-card payment-icon text-primary"></i>
                                <div>
                                    <h5 class="mb-1">بطاقة ائتمان / مدى</h5>
                                    <p class="mb-0 text-muted">الدفع باستخدام بطاقة الائتمان أو بطاقة مدى</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="payment-method" data-method="applepay">
                            <div class="d-flex align-items-center">
                                <i class="bi bi-phone payment-icon text-dark"></i>
                                <div>
                                    <h5 class="mb-1">Apple Pay</h5>
                                    <p class="mb-0 text-muted">الدفع باستخدام Apple Pay</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="payment-method" data-method="mada">
                            <div class="d-flex align-items-center">
                                <i class="bi bi-credit-card-2-front payment-icon text-success"></i>
                                <div>
                                    <h5 class="mb-1">مدى</h5>
                                    <p class="mb-0 text-muted">الدفع باستخدام بطاقة مدى</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="payment-method" data-method="stcpay">
                            <div class="d-flex align-items-center">
                                <i class="bi bi-phone payment-icon text-primary"></i>
                                <div>
                                    <h5 class="mb-1">STC Pay</h5>
                                    <p class="mb-0 text-muted">الدفع باستخدام STC Pay</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card shadow-sm" id="creditCardForm">
                    <div class="card-header bg-light fw-bold">معلومات البطاقة</div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="cardNumber" class="form-label">رقم البطاقة</label>
                            <input type="text" class="form-control" id="cardNumber" placeholder="1234 5678 9012 3456" maxlength="19">
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="expiryDate" class="form-label">تاريخ الانتهاء</label>
                                <input type="text" class="form-control" id="expiryDate" placeholder="MM/YY" maxlength="5">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="cvv" class="form-label">رمز الأمان (CVV)</label>
                                <input type="text" class="form-control" id="cvv" placeholder="123" maxlength="3">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="cardHolder" class="form-label">اسم حامل البطاقة</label>
                            <input type="text" class="form-control" id="cardHolder" placeholder="كما هو مدون على البطاقة">
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="card shadow-sm sticky-top" style="top: 20px;">
                    <div class="card-header bg-light fw-bold">ملخص الطلب</div>
                    <div class="card-body">
                        <div class="d-flex justify-content-between mb-2">
                            <span>استشارة مع المحامي سعود القحطاني</span>
                            <span>180 ر.س</span>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span>رسوم الخدمة</span>
                            <span>10 ر.س</span>
                        </div>
                        <hr>
                        <div class="d-flex justify-content-between mb-3">
                            <strong>المبلغ الإجمالي</strong>
                            <strong>190 ر.س</strong>
                        </div>
                        <button class="btn btn-primary-custom w-100 btn-lg" id="completePaymentBtn">
                            <i class="bi bi-lock-fill me-2"></i> إتمام الدفع
                        </button>
                        <p class="text-muted small text-center mt-2">
                            <i class="bi bi-shield-check me-1"></i>
                            عملية الدفع آمنة ومشفرة
                        </p>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- شاشة تأكيد الحجز -->
    <div class="container py-5" id="confirmationScreen" style="display: none;">
        <div class="card shadow-lg border-0 text-center py-5">
            <div class="card-body">
                <div class="mb-4">
                    <i class="bi bi-check-circle-fill text-success" style="font-size: 4rem;"></i>
                </div>
                <h2 class="mb-3" style="color: #00bcd4;">تم تأكيد حجز موعدك بنجاح!</h2>
                <p class="lead mb-4">سيتم إرسال تفاصيل الجلسة إلى بريدك الإلكتروني ورقم هاتفك</p>
                
                <div class="card mx-auto mb-4" style="max-width: 500px;">
                    <div class="card-body text-start">
                        <h5 class="card-title mb-3">تفاصيل الحجز</h5>
                        <div class="d-flex justify-content-between mb-2">
                            <span>الخبير:</span>
                            <strong>المحامي سعود القحطاني</strong>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span>التاريخ:</span>
                            <strong id="confirmationDate">الأربعاء, 8 أكتوبر 2025</strong>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span>الوقت:</span>
                            <strong id="confirmationTime">01:30 مساءً</strong>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span>المبلغ المدفوع:</span>
                            <strong>190 ر.س</strong>
                        </div>
                        <div class="d-flex justify-content-between">
                            <span>رقم الحجز:</span>
                            <strong>#RES-2025-4872</strong>
                        </div>
                    </div>
                </div>
                
                <div class="d-flex justify-content-center gap-3">
                    <a href="client-browse.html" class="btn btn-outline-primary">
                        <i class="bi bi-house me-2"></i> العودة للرئيسية
                    </a>
                    <a href="my-appointments.html" class="btn btn-primary-custom">
                        <i class="bi bi-calendar-check me-2"></i> عرض مواعيدي
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        $(document).ready(function() {
            // بيانات الأوقات المتاحة لكل تاريخ
            const availableTimes = {
                "2025-10-07": ["10:00", "10:30", "11:30", "1:30", "2:00", "3:00", "3:30", "4:00", "4:30"],
                "2025-10-08": ["10:00", "10:30", "11:30", "1:30", "2:00"],
                "2025-10-09": [],
                "2025-10-10": ["9:00", "9:30", "10:00", "10:30", "11:00", "11:30", "1:30", "2:00", "2:30", "3:00"],
                "2025-10-11": ["9:00", "9:30", "10:00", "10:30", "11:00", "11:30", "12:00", "1:30", "2:00", "2:30", "3:00", "3:30"]
            };
            
            // الأوقات المحجوزة لكل تاريخ
            const bookedTimes = {
                "2025-10-07": ["11:00", "12:00"],
                "2025-10-08": ["11:00", "12:00", "2:30"],
                "2025-10-09": [],
                "2025-10-10": ["12:00"],
                "2025-10-11": ["1:00"]
            };
            
            // الأوقات المستراحة لكل تاريخ
            const breakTimes = {
                "2025-10-07": ["12:00"],
                "2025-10-08": ["12:00"],
                "2025-10-09": [],
                "2025-10-10": ["12:00"],
                "2025-10-11": ["12:00"]
            };
            
            // متغيرات لتخزين البيانات المختارة
            let selectedDate = "2025-10-08";
            let selectedTime = "1:30";
            let selectedPaymentMethod = "credit";
            
            // تهيئة الأوقات المتاحة للتاريخ الافتراضي
            updateTimeSlots(selectedDate);
            
            // منطق اختيار التاريخ
            $('.date-select').on('click', function() {
                const date = $(this).data('date');
                const isAvailable = $(this).find('.badge').hasClass('bg-success') || $(this).find('.badge').hasClass('bg-primary');
                
                if (isAvailable) {
                    $('.date-select').removeClass('active');
                    $(this).addClass('active');
                    selectedDate = date;
                    
                    // تحديث عنوان الأوقات المتاحة
                    const dateText = $(this).text().split(' (')[0];
                    $('#timeHeader').text(`الأوقات المتاحة (${dateText})`);
                    
                    // تحديث الأوقات المتاحة
                    updateTimeSlots(date);
                    
                    // تحديث ملخص الحجز
                    updateBookingSummary();
                }
            });
            
            // منطق اختيار الوقت
            $(document).on('click', '.time-slot:not(.unavailable)', function() {
                $('.time-slot:not(.unavailable)').removeClass('selected');
                $(this).addClass('selected');
                selectedTime = $(this).data('time');
                
                // تحديث ملخص الحجز
                updateBookingSummary();
            });
            
            // تحديث الأوقات المتاحة بناءً على التاريخ المختار
            function updateTimeSlots(date) {
                $('#timeSlots').empty();
                
                const times = availableTimes[date] || [];
                const booked = bookedTimes[date] || [];
                const breaks = breakTimes[date] || [];
                
                if (times.length === 0) {
                    $('#timeSlots').html('<div class="col-12 text-center py-4"><p class="text-muted">لا توجد أوقات متاحة لهذا التاريخ</p></div>');
                    return;
                }
                
                times.forEach(time => {
                    const isBooked = booked.includes(time);
                    const isBreak = breaks.includes(time);
                    const isSelected = (date === selectedDate && time === selectedTime);
                    
                    let timeClass = "time-slot";
                    let timeText = time;
                    
                    if (isBooked) {
                        timeClass += " unavailable";
                        timeText += " (محجوز)";
                    } else if (isBreak) {
                        timeClass += " unavailable";
                        timeText += " (استراحة)";
                    } else if (isSelected) {
                        timeClass += " selected";
                    }
                    
                    $('#timeSlots').append(`
                        <div class="col-4">
                            <div class="${timeClass}" data-time="${time}">${timeText}</div>
                        </div>
                    `);
                });
            }
            
            // تحديث ملخص الحجز
            function updateBookingSummary() {
                const dateElement = $(`.date-select[data-date="${selectedDate}"]`);
                const dateText = dateElement.text().split(' (')[0];
                
                $('#summaryDate').text(dateText);
                $('#summaryTime').text(selectedTime);
            }
            
            // الانتقال إلى شاشة الدفع
            $('#confirmBookingBtn').on('click', function() {
                if (!selectedTime) {
                    alert('يرجى اختيار وقت للحجز أولاً');
                    return;
                }
                
                $('#bookingScreen').hide();
                $('#paymentScreen').show();
                
                // تحديث بيانات التأكيد
                $('#confirmationDate').text($('#summaryDate').text());
                $('#confirmationTime').text($('#summaryTime').text());
            });
            
            // العودة إلى شاشة الحجز
            $('#backToBookingBtn').on('click', function() {
                $('#paymentScreen').hide();
                $('#bookingScreen').show();
            });
            
            // اختيار طريقة الدفع
            $('.payment-method').on('click', function() {
                $('.payment-method').removeClass('selected');
                $(this).addClass('selected');
                selectedPaymentMethod = $(this).data('method');
                
                // إظهار/إخفاء نموذج بطاقة الائتمان
                if (selectedPaymentMethod === 'credit') {
                    $('#creditCardForm').show();
                } else {
                    $('#creditCardForm').hide();
                }
            });
            
            // إتمام عملية الدفع
            $('#completePaymentBtn').on('click', function() {
                // التحقق من صحة البيانات إذا كانت بطاقة ائتمان
                if (selectedPaymentMethod === 'credit') {
                    const cardNumber = $('#cardNumber').val();
                    const expiryDate = $('#expiryDate').val();
                    const cvv = $('#cvv').val();
                    const cardHolder = $('#cardHolder').val();
                    
                    if (!cardNumber || !expiryDate || !cvv || !cardHolder) {
                        alert('يرجى ملء جميع بيانات البطاقة');
                        return;
                    }
                    
                    // التحقق من صحة رقم البطاقة (مثال مبسط)
                    if (cardNumber.replace(/\s/g, '').length !== 16) {
                        alert('يرجى إدخال رقم بطاقة صحيح (16 رقم)');
                        return;
                    }
                }
                
                // محاكاة عملية الدفع
                $(this).prop('disabled', true).html('<span class="spinner-border spinner-border-sm me-2"></span> جاري المعالجة...');
                
                setTimeout(function() {
                    $('#paymentScreen').hide();
                    $('#confirmationScreen').show();
                }, 2000);
            });
            
            // تنسيق رقم البطاقة تلقائياً
            $('#cardNumber').on('input', function() {
                let value = $(this).val().replace(/\D/g, '');
                value = value.replace(/(\d{4})/g, '$1 ').trim();
                $(this).val(value.substring(0, 19));
            });
            
            // تنسيق تاريخ الانتهاء تلقائياً
            $('#expiryDate').on('input', function() {
                let value = $(this).val().replace(/\D/g, '');
                if (value.length >= 2) {
                    value = value.substring(0, 2) + '/' + value.substring(2, 4);
                }
                $(this).val(value);
            });
            
            // تقييد إدخال CVV لأرقام فقط
            $('#cvv').on('input', function() {
                $(this).val($(this).val().replace(/\D/g, ''));
            });
        });
    </script>
</body>
</html>